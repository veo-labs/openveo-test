<!DOCTYPE html>
<html lang="en" class="yui-overrride">
<head>
    <meta charset="utf-8">
    <title>lib\e2e\pages\BackEndPage.js - OpenVeo test API</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1 class="blue-main-title">OpenVeo test API</h1>
        </div>
        <div class="yui3-u-1-4 version project-version">
            API Docs for: 5.0.0
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/BackEndPage.html">BackEndPage</a></li>
                                <li><a href="../classes/browser.html">browser</a></li>
                                <li><a href="../classes/CheckboxesField.html">CheckboxesField</a></li>
                                <li><a href="../classes/CheckboxField.html">CheckboxField</a></li>
                                <li><a href="../classes/DateField.html">DateField</a></li>
                                <li><a href="../classes/FakeField.html">FakeField</a></li>
                                <li><a href="../classes/Field.html">Field</a></li>
                                <li><a href="../classes/Helper.html">Helper</a></li>
                                <li><a href="../classes/i18n.html">i18n</a></li>
                                <li><a href="../classes/karma-ng-inline-templates-preprocessor.html">karma-ng-inline-templates-preprocessor</a></li>
                                <li><a href="../classes/MatchField.html">MatchField</a></li>
                                <li><a href="../classes/MatchTagsField.html">MatchTagsField</a></li>
                                <li><a href="../classes/MatchTextField.html">MatchTextField</a></li>
                                <li><a href="../classes/Page.html">Page</a></li>
                                <li><a href="../classes/screenshotPlugin.html">screenshotPlugin</a></li>
                                <li><a href="../classes/SelectField.html">SelectField</a></li>
                                <li><a href="../classes/TableAssert.html">TableAssert</a></li>
                                <li><a href="../classes/TablePage.html">TablePage</a></li>
                                <li><a href="../classes/TagsField.html">TagsField</a></li>
                                <li><a href="../classes/TextareaField.html">TextareaField</a></li>
                                <li><a href="../classes/TextField.html">TextField</a></li>
                                <li><a href="../classes/TimeField.html">TimeField</a></li>
                                <li><a href="../classes/TinyMCEField.html">TinyMCEField</a></li>
                                <li><a href="../classes/util.html">util</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/e2e.html">e2e</a></li>
                                <li><a href="../modules/unit.html">unit</a></li>
                                <li><a href="../modules/util.html">util</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: lib\e2e\pages\BackEndPage.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x27;use strict&#x27;;

/**
 * @module e2e
 */

var util = require(&#x27;util&#x27;);
var openVeoApi = require(&#x27;@openveo/api&#x27;);
var Page = process.requireTest(&#x27;lib/e2e/pages/Page.js&#x27;);
var browserExt = process.requireTest(&#x27;lib/e2e/browser.js&#x27;);
var i18n = process.requireTest(&#x27;lib/e2e/i18n.js&#x27;);
var users = process.requireTest(&#x27;lib/e2e/users.json&#x27;);

// List of available languages
var languages = [
  {
    code: &#x27;en&#x27;,
    translationCode: &#x27;ENGLISH&#x27;
  },
  {
    code: &#x27;fr&#x27;,
    translationCode: &#x27;FRENCH&#x27;
  }
];

/**
 * Defines a back end page to help writing end to end tests on OpenVeo back end pages.
 *
 * Do not use this directly but extend it.
 *
 * @example
 *
 *     var BackEndPage = require(&#x27;@openveo/test&#x27;).e2e.pages.BackEndPage;
 *
 *     function MyBackEndPage() {
 *       MyBackEndPage.super_.call(this);
 *       this.path = &#x27;be/myBackEndPage&#x27;;
 *     }
 *
 *     module.exports = MyBackEndPage;
 *     util.inherits(MyBackEndPage, BackEndPage);
 *
 *     var page = new MyBackEndPage();
 *     page.logAsAdmin();
 *     page.load().then(function() {
 *       console.log(&#x27;Page fully loaded in the first language of the list of languages&#x27;);
 *     });
 *
 * @class BackEndPage
 * @extends Page
 * @constructor
 */
function BackEndPage() {
  BackEndPage.super_.call(this);

  Object.defineProperties(this, {

    /**
     * List of alert elements.
     *
     * @property alertElements
     * @type ElementArrayFinder
     * @final
     */
    alertElements: {value: element.all(by.css(&#x27;.alert&#x27;))},

    /**
     * Popover element.
     *
     * @property popoverElement
     * @type ElementFinder
     * @final
     */
    popoverElement: {value: element(by.css(&#x27;.popover&#x27;))},

    /**
     * Button to toggle left menu.
     *
     * @property toggleLeftMenuLinkElement
     * @type ElementFinder
     * @final
     */
    toggleLeftMenuLinkElement: {value: element(by.css(&#x27;.navbar-header button&#x27;))},

    /**
     * Left menu wrapper element.
     *
     * Displayed or not as the left menu is opened or not.
     *
     * @property leftMenuElement
     * @type ElementFinder
     * @final
     */
    leftMenuElement: {value: element(by.id(&#x27;sidebar-wrapper&#x27;))},

    /**
     * Profile link element.
     *
     * @property profileLinkElement
     * @type ElementFinder
     * @final
     */
    profileLinkElement: {value: element(by.css(&#x27;.nav a[href=&quot;profile&quot;]&#x27;))},

    /**
     * Language link element to open the list of languages.
     *
     * @property languageLinkElement
     * @type ElementFinder
     * @final
     */
    languageLinkElement: {value: element(by.css(&#x27;.nav .language &gt; a&#x27;))},

    /**
     * Logout link element.
     *
     * @property logoutLinkElement
     * @type ElementFinder
     * @final
     */
    logoutLinkElement: {value: element(by.css(&#x27;.nav a[href=&quot;logout&quot;]&#x27;))},

    /**
     * List of first level link elements in left menu.
     *
     * @property level1MenuLinkElements
     * @type ElementArrayFinder
     * @final
     */
    level1MenuLinkElements: {value: element.all(by.css(&#x27;#sidebar-wrapper &gt; ul &gt; li&#x27;))},

    /**
     * List of back end translations.
     *
     * @property translations
     * @type Object
     */
    translations: {value: null, writable: true}

  });
}

module.exports = BackEndPage;
util.inherits(BackEndPage, Page);

/**
 * Looks for a menu item and click on it.
 *
 * This will look for the item in menu and sub menus to find the item by its name.
 *
 * @method clickMenuRecursive
 * @private
 * @param {ElementArrayFinder} elements Menu items elements
 * @param {itemName} itemName Name of the menu item to look for
 * @return {Promise} A promise resolving when the menu item is clicked
 */
function clickMenuRecursive(elements, itemName) {
  var self = this;
  var deferred = protractor.promise.defer();
  var found = false;

  // Iterate through menu items
  elements.each(function(menuItem, index) {

    // Get menu item link
    var menuLink = menuItem.element(by.xpath(&#x27;./a&#x27;));

    // Get menu item text
    return menuLink.getText().then(function(text) {
      if (found) return protractor.promise.fulfilled();
      if (text === itemName) {

        // Found the expected menu item
        found = true;

        // Click on the menu item
        return browserExt.click(menuItem);

      } else {

        // Menu item does not correspond to the searched one
        // Try in item sub menu (if any)

        var subMenu = menuItem.element(by.css(&#x27;.sub-menu&#x27;));
        return subMenu.isPresent().then(function(isPresent) {
          if (isPresent) {

            // Got a sub menu for this item

            // Open sub menu
            browserExt.click(menuLink);

            // Wait for sub menu to be opened
            browser.wait(self.EC.visibilityOf(subMenu), 5000, &#x27;Missing sub menu&#x27;);

            // Looks for the searched item in the sub menu
            return clickMenuRecursive.call(self, menuItem.all(by.css(&#x27;.sub-menu &gt; li&#x27;)), itemName).then(function() {
              found = true;
            }).catch(function(error) {

              // Do not catch sub errors

            });
          }
        });
      }
    });

  }).then(function() {
    if (found)
      deferred.fulfill();
    else
      deferred.reject(new Error(&#x27;Item &quot;&#x27; + itemName + &#x27;&quot; not found&#x27;));
  }).catch(function(error) {
    deferred.reject(error);
  });

  return deferred.promise;
}

/**
 * Loads the page and select the first available language.
 *
 * This will automatically select the first language in the list of available languages.
 *
 * @example
 *
 *     var BackEndPage = require(&#x27;@openveo/test&#x27;).e2e.pages.BackEndPage;
 *
 *     function MyBackEndPage() {
 *       MyBackEndPage.super_.call(this);
 *       this.path = &#x27;be/myBackEndPage&#x27;;
 *     }
 *
 *     module.exports = MyBackEndPage;
 *     util.inherits(MyBackEndPage, BackEndPage);
 *
 *     var page = new MyBackEndPage();
 *     page.logAsAdmin();
 *     page.load().then(function() {
 *       console.log(&#x27;Page fully loaded in the first language&#x27;);
 *     });
 *
 * @method load
 * @return {Promise} Promise resolving when the page is loaded and language changed
 */
BackEndPage.prototype.load = function() {
  var self = this;

  return Page.prototype.load.call(this).then(function() {
    return self.selectLanguage(languages[0]);
  });

};

/**
 * Sets page language.
 *
 * It uses the top menu to change the language, a page reload will be performed.
 *
 * @example
 *
 *     // With MyBackEndPage extending BackEndPage
 *     var page = new MyBackEndPage();
 *     var languages = page.getLanguages();
 *
 *     page.logAsAdmin();
 *     page.selectLanguage(languages[1]).then(function() {
 *       console.log(&#x27;Page reloaded in french&#x27;);
 *     });
 *
 * @method selectLanguage
 * @param {Object} language The language to load
 * @return {Promise} Promise resolving when the page is reloaded with the expected language
 */
BackEndPage.prototype.selectLanguage = function(language) {
  var self = this;

  // Save language
  this.language = language;

  // Click on the languages link
  return browserExt.click(this.languageLinkElement).then(function() {

    // Get language link
    var languageOptionLink = self.getLanguageOption(self.language.code);

    // Click on the language
    browserExt.click(languageOptionLink, 1000);

    // Wait for page to be reloaded
    Page.prototype.load.call(self);

    // Wait for page to be fully loaded
    return self.onLoaded();
  }).then(function() {

    // Get back end translations
    return i18n.getBackEndTranslations(self.language.code);

  }).then(function(backEndTranslations) {
    self.translations = backEndTranslations;
  }).then(function() {
    return protractor.promise.fulfilled();
  });
};

/**
 * Gets language link element.
 *
 * @example
 *
 *     // With MyBackEndPage extending BackEndPage
 *     var page = new MyBackEndPage();
 *     page.click(page.getLanguageOption(&#x27;fr&#x27;)).then(function() {
 *       console.log(&#x27;Page is now in french&#x27;);
 *     });
 *
 * @method getLanguageOption
 * @param {String} languageCode The language code to load (e.g. en)
 * @return {ElementFinder} The language option element
 */
BackEndPage.prototype.getLanguageOption = function(languageCode) {
  return element(by.css(&#x27;.nav .language li &gt; .&#x27; + languageCode));
};

/**
 * Authenticates to the back end using the given account.
 *
 * If an account is already logged in, it will be logged out.
 *
 * @example
 *
 *     var user = {
 *       &quot;email&quot;: &quot;some-user@veo-labs.com&quot;,
 *       &quot;password&quot;: &quot;some-user&quot;
 *     }
 *
 *     // With MyBackEndPage extending BackEndPage
 *     var page = new MyBackEndPage();
 *     page.logAs(user).then(function() {
 *       console.log(&#x27;Logged as some-user&#x27;);
 *     });
 *
 * @method logAs
 * @param {Object} user Information about the user
 * @return {Promise} Promise resolving when authenticated to the back end
 */
BackEndPage.prototype.logAs = function(user) {
  var self = this;

  // Logout any connected user
  return self.logout().then(function() {

    // Login page elements
    var userInput = element(by.model(&#x27;userLogin&#x27;));
    var passwordInput = element(by.model(&#x27;password&#x27;));
    var button = element(by.binding(&#x27;LOGIN.SUBMIT&#x27;));

    // Waits for login fields and submit button to be present
    browser.wait(self.EC.and(
      self.EC.visibilityOf(userInput),
      self.EC.visibilityOf(passwordInput),
      self.EC.visibilityOf(button)), 5000, &#x27;Missing one or several login fields&#x27;);

    // Fill the formular with user information
    userInput.sendKeys(user.email);
    passwordInput.sendKeys(user.password);

    // Submit formular
    return browserExt.click(button).then(function() {
      self.user = user;
      browser.wait(self.EC.visibilityOf(self.toggleLeftMenuLinkElement), 5000, &#x27;Missing left menu toggle button&#x27;);
      return protractor.promise.fulfilled();
    });

  });
};

/**
 * Authenticates to the back end using the given CAS account.
 *
 * cas-server-mock module must be used for this to work.
 * Also process.protractorConf.casConf.userIdAttribute should be set to the name of the CAS user attribute
 * which must be used as user&#x27;s login.
 * If an account is already logged in, it will be logged out.
 *
 * @example
 *
 *     var user =   {
 *       name: &#x27;test&#x27;,
 *       attributes: {
 *         name: &#x27;test&#x27;,
 *         mail: &#x27;test@openveo.com&#x27;,
 *         groups: [&#x27;test-group1&#x27;, &#x27;test-group2&#x27;]
 *       }
 *     };
 *
 *     // With MyBackEndPage extending BackEndPage
 *     var page = new MyBackEndPage();
 *     page.logToCasAs(user).then(function() {
 *       console.log(&#x27;Logged as test&#x27;);
 *     });
 *
 * @method logToCasAs
 * @param {Object} user Information about the CAS user
 * @return {Promise} Promise resolving when authenticated to the back end
 */
BackEndPage.prototype.logToCasAs = function(user) {
  var self = this;

  // Logout any connected user
  return self.logout().then(function() {
    var userIdAttribute = process.protractorConf.casConf.userIdAttribute;

    // CAS button on login page and input with submit button on CAS page
    var casButtonFinder = element(by.css(&#x27;.ov-cas-button &gt; a&#x27;));
    var loginFieldFinder = element(by.model(&#x27;ctrl.login&#x27;));
    var submitButtonFinder = element(by.css(&#x27;input[type=&quot;submit&quot;]&#x27;));

    // Click on CAS button from login page
    casButtonFinder.click();

    // Submit login informations on CAS page
    loginFieldFinder.sendKeys(openVeoApi.util.evaluateDeepObjectProperties(userIdAttribute, user));
    submitButtonFinder.click().then(function() {
      self.user = user;
      browser.wait(self.EC.visibilityOf(self.toggleLeftMenuLinkElement), 5000, &#x27;Missing left menu toggle button&#x27;);
      return protractor.promise.fulfilled();
    });

  });
};

/**
 * Authenticates to the back end using the given LDAP account.
 *
 * process.protractorConf.ldapConf.userIdAttribute should be set to the name of the LDAP user attribute
 * which must be used as user&#x27;s login.
 * If an account is already logged in, it will be logged out.
 *
 * @example
 *
 *     var user = {
 *       dn: &#x27;cn=test,dc=test&#x27;,
 *       cn: &#x27;test&#x27;,
 *       groups: &#x27;test-group1,test-group2&#x27;,
 *       mail: &#x27;test@openveo.com&#x27;
 *     };
 *
 *     // With MyBackEndPage extending BackEndPage
 *     var page = new MyBackEndPage();
 *     page.logToLdapAs(user).then(function() {
 *       console.log(&#x27;Logged as test&#x27;);
 *     });
 *
 * @method logToLdapAs
 * @param {Object} user Information about the LDAP user
 * @return {Promise} Promise resolving when authenticated to the back end
 */
BackEndPage.prototype.logToLdapAs = function(user) {
  var self = this;

  // Logout any connected user
  return self.logout().then(function() {
    var userIdAttribute = process.protractorConf.ldapConf.userIdAttribute;

    // Login page elements
    var userInputFinder = element(by.model(&#x27;userLogin&#x27;));
    var passwordInputFinder = element(by.model(&#x27;password&#x27;));
    var buttonFinder = element(by.binding(&#x27;LOGIN.SUBMIT&#x27;));

    // Fill the formular with user information
    // Password is not important here, it could by anything
    userInputFinder.sendKeys(openVeoApi.util.evaluateDeepObjectProperties(userIdAttribute, user));
    passwordInputFinder.sendKeys(&#x27;something&#x27;);

    // Submit formular
    return browserExt.click(buttonFinder).then(function() {
      self.user = user;
      browser.wait(self.EC.visibilityOf(self.toggleLeftMenuLinkElement), 5000, &#x27;Missing left menu toggle button&#x27;);
      return protractor.promise.fulfilled();
    });

  });
};

/**
 * Logs to the back end using the super administrator account.
 *
 * The super administrator can perform any actions.
 * If an account is already logged in, it will be logged out. Super administrator is also locked.
 *
 * @example
 *
 *     // With MyBackEndPage extending BackEndPage
 *     var page = new MyBackEndPage();
 *     page.logAsAdmin().then(function() {
 *       console.log(&#x27;Logged as super admin&#x27;);
 *     });
 *
 * @method logAsAdmin
 * @return {Promise} Promise resolving when authenticated as the super administrator
 */
BackEndPage.prototype.logAsAdmin = function() {
  return this.logAs(users.testSuperAdmin);
};

/**
 * Gets current logged in user.
 *
 * @example
 *
 *     // With MyBackEndPage extending BackEndPage
 *     var page = new MyBackEndPage();
 *     page.logAsAdmin().then(function() {
 *       console.log(page.getUser());
 *     });
 *
 * @method getUser
 * @return {Object} The current logged in user
 */
BackEndPage.prototype.getUser = function() {
  return this.user;
};

/**
 * Logs out current authenticated user.
 *
 * This will lead to the login page.
 *
 * @example
 *
 *     // With MyBackEndPage extending BackEndPage
 *     var page = new MyBackEndPage();
 *     page.logAsAdmin();
 *     page.logout().then(function() {
 *       console.log(&#x27;Logged out&#x27;);
 *     });
 *
 * @method logout
 * @return {Promise} Promise resolving when user is logged out and login page is displayed
 */
BackEndPage.prototype.logout = function() {
  var self = this;

  // Load login page
  return browser.get(&#x27;be/login&#x27;).then(function() {
    return browser.getCurrentUrl();
  }).then(function(currentUrl) {
    if (currentUrl === process.protractorConf.baseUrl + &#x27;be/login&#x27;) {

      // Current page is already the login page thus user is already logged out
      return protractor.promise.fulfilled();

    } else {

      // User is connected, logout
      return browserExt.click(self.logoutLinkElement).then(function() {
        self.user = null;

        // Login page elements
        var userInput = element(by.model(&#x27;userLogin&#x27;));
        var passwordInput = element(by.model(&#x27;password&#x27;));
        var button = element(by.binding(&#x27;LOGIN.SUBMIT&#x27;));

        // Waits for login page to be present
        return browser.wait(self.EC.and(self.EC.visibilityOf(userInput),
                                        self.EC.visibilityOf(passwordInput),
                                        self.EC.visibilityOf(button)), 5000, &#x27;Missing one or several login fields&#x27;);

      });
    }
  }).then(function() {
    return protractor.promise.fulfilled();
  });
};

/**
 * Gets the list of available languages.
 *
 * @example
 *
 *     // With MyBackEndPage extending BackEndPage
 *     var page = new MyBackEndPage();
 *     console.log(page.getLanguages());
 *
 * @method getLanguages
 * @return {Array} The list of available languages
 */
BackEndPage.prototype.getLanguages = function() {
  return languages;
};

/**
 * Gets level 1 menu items.
 *
 * All level 1 menu items will be returned with the promise unless itemName is specified then all elements
 * corresponding to the item name will be returned.
 *
 * @example
 *
 *     // With MyBackEndPage extending BackEndPage
 *     var page = new MyBackEndPage();
 *     page.logAsAdmin();
 *     page.getLevel1MenuItems(&#x27;Rights&#x27;).then(function(elements) {
 *       console.log(elements);
 *     });
 *
 * @method getLevel1MenuItems
 * @param {String} [itemName] The translated name of the menu item to look for, leave empty to get all
 * level 1 menu items
 * @return {Promise} Promise resolving with the list of elements
 */
BackEndPage.prototype.getLevel1MenuItems = function(itemName) {
  var self = this;

  return this.openMenu().then(function() {
    var deferred = protractor.promise.defer();

    self.level1MenuLinkElements.filter(function(menuLink, index) {
      return menuLink.element(by.xpath(&#x27;./a&#x27;)).getText().then(function(text) {
        return (itemName === text || !itemName);
      });
    }).then(function(items) {
      deferred.fulfill(items);
    }, function(error) {
      deferred.reject(error);
    });

    return deferred.promise;
  });
};

/**
 * Gets level 2 menu items.
 *
 * All level 2 menu items will be returned with the promise unless itemName is specified then all elements
 * corresponding to the item name will be returned.
 *
 * @example
 *
 *     // With MyBackEndPage extending BackEndPage
 *     var page = new MyBackEndPage();
 *     page.logAsAdmin();
 *     page.getLevel2MenuItems(&#x27;Rights&#x27;, &#x27;Users&#x27;).then(function(elements) {
 *       console.log(elements);
 *     });
 *
 * @method getLevel2MenuItems
 * @param {String} level1ItemName The translated name of the first level menu item to look for
 * @param {String} [level2ItemName] The translated name of the second menu item to look for, leave empty to get all
 * level 2 menu items
 * @return {Promise} Promise resolving with the list of elements
 */
BackEndPage.prototype.getLevel2MenuItems = function(level1ItemName, level2ItemName) {
  var self = this;
  var level1MenuItem;

  return self.getLevel1MenuItems(level1ItemName).then(function(level1MenuItems) {
    if (level1MenuItems.length) {
      level1MenuItem = level1MenuItems[0];
      return self.openSubMenu(level1ItemName);
    } else
      return protractor.promise.rejected(new Error(&#x27;Menu item &#x27; + level1ItemName + &#x27; not found&#x27;));
  }).then(function() {
    var deferred = protractor.promise.defer();
    level1MenuItem.all(by.css(&#x27;.sub-menu &gt; li&#x27;)).filter(function(menuLink, index) {
      return menuLink.element(by.xpath(&#x27;./a&#x27;)).getText().then(function(text) {
        return (level2ItemName === text || !level2ItemName);
      });
    }).then(function(items) {
      deferred.fulfill(items);
    }, function(error) {
      deferred.reject(error);
    });

    return deferred.promise;
  });
};

/**
 * Opens left menu.
 *
 * @example
 *
 *     // With MyBackEndPage extending BackEndPage
 *     var page = new MyBackEndPage();
 *     page.logAsAdmin();
 *     page.openMenu().then(function() {
 *       console.log(&#x27;Left menu opened&#x27;);
 *     });
 *
 * @method openMenu
 * @return {Promise} Promise resolving when left menu is opened
 */
BackEndPage.prototype.openMenu = function() {
  var self = this;

  return this.leftMenuElement.isDisplayed().then(function(isDisplayed) {
    if (!isDisplayed) {

      // Open menu
      browserExt.click(self.toggleLeftMenuLinkElement);

      return browser.wait(self.EC.visibilityOf(self.leftMenuElement), 1000, &#x27;Missing left menu&#x27;);
    } else {

      // Menu is already displayed
      return protractor.promise.fulfilled();

    }
  }).then(function() {
    return protractor.promise.fulfilled();
  });
};

/**
 * Closes menu.
 *
 * @example
 *
 *     // With MyBackEndPage extending BackEndPage
 *     var page = new MyBackEndPage();
 *     page.logAsAdmin();
 *     page.closeMenu().then(function() {
 *       console.log(&#x27;Left menu closed&#x27;);
 *     });
 *
 * @method closeMenu
 * @return {Promise} Promise resolving when menu is closed
 */
BackEndPage.prototype.closeMenu = function() {
  var self = this;

  return this.leftMenuElement.isDisplayed().then(function(isDisplayed) {
    if (isDisplayed) {

      // Close menu
      browserExt.click(self.toggleLeftMenuLinkElement);

      // Wait for the menu to be invisible
      return browser.wait(self.EC.invisibilityOf(self.leftMenuElement), 1000, &#x27;Menu still visible&#x27;);
    } else {

      // Menu is already closed
      return protractor.promise.fulfilled();

    }
  }).then(function() {
    return protractor.promise.fulfilled();
  });
};

/**
 * Opens an item sub menu.
 *
 * @example
 *
 *     // With MyBackEndPage extending BackEndPage
 *     var page = new MyBackEndPage();
 *     page.logAsAdmin();
 *     page.openSubMenu(&#x27;Rights&#x27;).then(function() {
 *       console.log(&#x27;Rights sub menu opened&#x27;);
 *     });
 *
 * @method openSubMenu
 * @param {String} itemName The name of the menu item
 * @return {Promise} Promise resolving when sub menu is opened
 */
BackEndPage.prototype.openSubMenu = function(itemName) {
  var self = this;
  var menuItem;
  var subMenu;

  return this.leftMenuElement.isDisplayed().then(function(isDisplayed) {
    if (!isDisplayed)
      self.openMenu();

    // Find menu item element
    return self.getLevel1MenuItems(itemName);
  }).then(function(menuItems) {
    menuItem = menuItems[0];
    subMenu = menuItem.element(by.css(&#x27;.sub-menu&#x27;));
    return subMenu.isDisplayed();
  }).then(function(isSubMenuDisplayed) {
    if (isSubMenuDisplayed) {

      // Sub menu is already displayed
      return protractor.promise.fulfilled();

    } else {

      // Click on menu item
      browserExt.click(menuItem.element(by.xpath(&#x27;./a&#x27;)));

      // Wait for the sub menu to be visible
      return browser.wait(self.EC.visibilityOf(subMenu), 1000, &#x27;Missing sub menu&#x27;);

    }
  }).then(function() {
    return protractor.promise.fulfilled();
  });
};

/**
 * Tests if a sub menu is opened.
 *
 * @example
 *
 *     // With MyBackEndPage extending BackEndPage
 *     var page = new MyBackEndPage();
 *     page.logAsAdmin();
 *     page.isSubMenuOpened(&#x27;Rights&#x27;).then(function(isOpened) {
 *       console.log(&#x27;Is sub menu opened ?&#x27; + isOpened);
 *     });
 *
 * @method isSubMenuOpened
 * @param {String} itemName The name of the menu item
 * @return {Promise} Promise resolving with true if the sub menu is opened, false if it&#x27;s closed
 */
BackEndPage.prototype.isSubMenuOpened = function(itemName) {
  var self = this;

  return this.leftMenuElement.isDisplayed().then(function(isDisplayed) {
    if (!isDisplayed)
      self.openMenu();

    // Find menu item element
    return self.getLevel1MenuItems(itemName);
  }).then(function(menuItems) {
    return menuItems[0].element(by.css(&#x27;.sub-menu&#x27;)).isDisplayed();
  });
};

/**
 * Closes an item sub menu by its name.
 *
 * @example
 *
 *     // With MyBackEndPage extending BackEndPage
 *     var page = new MyBackEndPage();
 *     page.logAsAdmin();
 *     page.closeSubMenu(&#x27;Rights&#x27;).then(function() {
 *       console.log(&#x27;Rights sub menu closed&#x27;);
 *     });
 *
 * @method closeSubMenu
 * @param {String} itemName The name of the menu item having a sub menu
 * @return {Promise} Promise resolving when sub menu is closed
 */
BackEndPage.prototype.closeSubMenu = function(itemName) {
  var self = this;

  return this.leftMenuElement.isDisplayed().then(function(isDisplayed) {

    if (!isDisplayed) {

      // Menu is already closed, thus sub menu is also closed
      return protractor.promise.fulfilled();

    } else {

      // Find menu item element
      return self.getLevel1MenuItems(itemName).then(function(menuItems) {
        var menuItem = menuItems[0];
        var subMenu = menuItem.element(by.css(&#x27;.sub-menu&#x27;));

        return subMenu.isDisplayed().then(function(isSubMenuDisplayed) {

          if (!isSubMenuDisplayed) {

            // Sub menu is already closed
            return protractor.promise.fulfilled();

          } else {

            // Click on menu item
            browserExt.click(menuItem.element(by.xpath(&#x27;./a&#x27;)));

            // Wait for the sub menu to be invisible
            return browser.wait(self.EC.invisibilityOf(subMenu), 1000, &#x27;Sub menu still visible&#x27;);

          }

        });

      });

    }

  }).then(function() {
    return protractor.promise.fulfilled();
  });
};

/**
 * Clicks on a menu item.
 *
 * This will look for the item in menu and sub menus to find the item by its name.
 *
 * @example
 *
 *     // With MyBackEndPage extending BackEndPage
 *     var page = new MyBackEndPage();
 *     page.logAsAdmin();
 *     page.clickMenu(&#x27;Roles&#x27;).then(function() {
 *       console.log(&#x27;Roles menu item clicked&#x27;);
 *     });
 *
 * @method clickMenu
 * @param {String} itemName The name of the menu item
 * @return {Promise} Promise resolving when menu is clicked
 */
BackEndPage.prototype.clickMenu = function(itemName) {
  var self = this;

  return this.leftMenuElement.isDisplayed().then(function(isDisplayed) {
    if (!isDisplayed)
      self.openMenu();

    return clickMenuRecursive.call(self, self.level1MenuLinkElements, itemName);
  });
};

/**
 * Clicks on profile link.
 *
 * @example
 *
 *     // With MyBackEndPage extending BackEndPage
 *     var page = new MyBackEndPage();
 *     page.logAsAdmin();
 *     page.clickProfile().then(function() {
 *       console.log(&#x27;Profile link clicked&#x27;);
 *     });
 *
 * @method clickProfile
 * @return {Promise} Promise resolving when profile link is clicked
 */
BackEndPage.prototype.clickProfile = function() {
  return browserExt.click(this.profileLinkElement);
};

/**
 * Closes all alerts.
 *
 * @example
 *
 *     // With MyBackEndPage extending BackEndPage
 *     var page = new MyBackEndPage();
 *     page.logAsAdmin();
 *     page.closeAlerts().then(function() {
 *       console.log(&#x27;All alerts closed&#x27;);
 *     });
 *
 * @method closeAlerts
 * @return {Promise} Promise resolving when all alerts are closed
 */
BackEndPage.prototype.closeAlerts = function() {
  var self = this;

  return browser.waitForAngular().then(function() {
    var deferred = protractor.promise.defer();

    self.alertElements.each(function(alertElement, index) {
      browserExt.click(alertElement.element(by.css(&#x27;button&#x27;)));
    }).then(function() {
      deferred.fulfill();
    });

    return deferred.promise;

  });
};

/**
 * Gets all alert messages.
 *
 * @example
 *
 *     // With MyBackEndPage extending BackEndPage
 *     var page = new MyBackEndPage();
 *     page.logAsAdmin();
 *     page.getAlertMessages().then(function(messages) {
 *       console.log(messages);
 *     });
 *
 * @method getAlertMessages
 * @return {Promise} Promise resolving with all alert messages
 */
BackEndPage.prototype.getAlertMessages = function() {
  var self = this;

  return browser.waitForAngular().then(function() {
    var deferred = protractor.promise.defer();
    var messages = [];

    self.alertElements.each(function(alertElement, index) {
      alertElement.element(by.binding(&#x27;alert.msg&#x27;)).getText().then(function(message) {
        messages.push(message);
      });
    }).then(function() {
      deferred.fulfill(messages);
    });

    return deferred.promise;
  });
};

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
